Система синхронизации БД

1. НАЗНАЧЕНИЕ

Набор скриптов предназначен для синхронизации изменений БД.

2. ПРИНЦИП РАБОТЫ

Ревизия структуры базы данных хранится в специальной таблице _version, в поле 
комментария к таблице (это сделано для того чтобы номер ревизии хранился 
вместе со схемой базы данных).
Патчи хранятся в отдельных файлах update-xxx.sql


3. НАСТРОЙКА

Для настройки необходимо переименовать файл config.dist.php в config.php, 
настроить все параметры для синхронизируемой БД.
Для работы необходимо чтобы в системе были доступны утилиты mysql и mysqldump

4. ОБНОВЛЕНИЕ ЛОКАЛЬНОЙ БД

4.1. Провести обновление каталога /db в системе контроля версий:
     cd /path/to/db
     svn update
4.2. Выполнить sync.php (sync.bat).
    Все новые патчи (update-xxx.sql) выполнятся, а в журнал (logs/<дата>.log) 
добавится результат применения патчей. Ревизия БД установится на самый
cтарший номер патча.
Новая структура запишется в файл schema.sql (с информацией о ревизии).

5. ПОДГОТОВКА ПАТЧА

5.1. Убедится, что локальная ревизия базы данных последняя (например, провести 
обновление по п.2)
5.2. Создать пустой файл для нового патча (update-<xxx+1>.sql).
5.3. Провести одно или несколько изменений базы данных вручную или через 
phpMyAdmin.
5.4. Записать все выполненные SQL-скрипты в файл нового патча.
5.5. Увеличить номер ревизии в локальной БД:
     а) вручную
         ALTER TABLE `_version` COMMENT = '<Номер новой ревизии>';
     б) через phpMyAdmin:
         1) выбрать таблицу;
         2) нажать на вкладку "Операции";
         3) изменить поле "Комментарий к таблице";
         4) нажать ОК.
5.6. Зафиксировать изменения:
     cd /path/to/db
     svn add update-<xxx+1>.sql
     svn commit -m 'Описать суть изменений'

5.7. Оповестить других о созданном патче, чтобы избежать возможных конфликтов 
версий патчей.
